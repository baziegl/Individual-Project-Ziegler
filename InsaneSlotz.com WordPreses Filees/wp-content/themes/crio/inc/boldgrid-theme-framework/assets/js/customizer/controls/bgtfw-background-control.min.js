import PaletteSelector from"../color/palette-selector";const colorLib=window.net.brehaut,api=wp.customize;export default function(){"use strict";var t=function(){d(),api.section("background_image").expanded()&&(a(api("boldgrid_background_type")()),c())},a=t=>{let a={duration:0},o="image"===t?"deactivate":"activate";["boldgrid_background_color","boldgrid_background_pattern"].map(t=>api.control(t)[o](a))},o=()=>{let t=document.getElementById("boldgrid_background_pattern-control-wrapper"),a=document.getElementById("boldgrid_background_pattern-remove-pattern");$(a).on("click",()=>{$("#boldgrid_background_pattern .active-pattern").removeClass("active-pattern"),api("boldgrid_background_pattern").set(""),t.removeAttribute("data-pattern-selected"),a.disabled=!0}),$("#boldgrid_background_pattern .patternpreview").on("click",o=>{let e=$(o.currentTarget);e.hasClass("active-pattern")||($("#boldgrid_background_pattern .active-pattern").removeClass("active-pattern"),e.addClass("active-pattern"),api("boldgrid_background_pattern").set(e.css("background-image")),t.dataset.patternSelected=1,a.disabled=!1)}),$(".accordion-section-content, .wp-full-overlay-sidebar-content").on("scroll",function(){let t=$(this);75<=t.scrollTop()&&"pattern"===api("boldgrid_background_type")()?t.addClass("boldgrid-sticky-customizer"):t.removeClass("boldgrid-sticky-customizer")})},e=async function(){const t=await import("hero-patterns");let a,o=(new PaletteSelector).getColor(api("boldgrid_background_color")(),!0);return a=api.previewer.targetWindow().BOLDGRID.Customizer.Util.getTextContrast(o),o=colorLib.Color(o),o=(o=a.includes("light")?o.lightenByAmount(.075):o.darkenByAmount(.075)).toCSS(),$("#boldgrid_background_pattern .patternpreview").each(function(){this.style.backgroundImage=t[this.dataset.background](o)}),!0},r=function(){$(`#boldgrid_background_pattern .patternpreview[style*='background-image: ${wp.customize("boldgrid_background_pattern")()}']`).addClass("active-pattern")},i=function(t){var a="";t||(t=api("boldgrid_background_color")()),$("#customizer_boldgrid_background_color").remove(),t&&(a+='<style id="customizer_boldgrid_background_color">',a+="#customize-control-boldgrid_background_pattern .patternpreview{background-color:"+t.split(":").pop()+";}",a+="</style>",$("head").append($(a)))},d=()=>{api("boldgrid_background_color","boldgrid_color_palette",(...t)=>t.map(t=>t.bind(n)))},n=()=>{"pattern"===api("boldgrid_background_type")()&&e().then(()=>{let t=$("#customize-control-boldgrid_background_pattern").find(".active-pattern").css("background-image");$("#boldgrid_background_pattern input").val(t).change(),api("boldgrid_background_pattern").set(t),i()})},c=function(){var t={duration:0},a=api("boldgrid_background_type")();"pattern"===a?(api.control("boldgrid_background_pattern").activate(t),api.control("boldgrid_background_color").activate(t),api.control("boldgrid_background_image_size").deactivate(t),api.control("background_image").deactivate(t),api.control("background_repeat").deactivate(t),l().deactivate(t)):(api.control("boldgrid_background_image_size").activate(t),api.control("background_image").activate(t),l().activate(t),api.control("background_repeat").activate(t),api("background_image")()?(api.control("boldgrid_background_image_size").activate(t),l().activate(t),api.control("background_repeat").activate(t)):(api.control("boldgrid_background_image_size").deactivate(t),l().deactivate(t),api.control("background_repeat").deactivate(t)),"parallax"===api("background_attachment")()&&(api.control("boldgrid_background_image_size").deactivate(t),api.control("background_repeat").deactivate(t))),g(a)},g=function(t){var a,o={duration:0},e=api.control("bgtfw_background_overlay"),r=api("background_image"),i=api.control("bgtfw_background_overlay_color"),d=api.control("bgtfw_background_overlay_type"),n=api.control("bgtfw_background_overlay_alpha");e[a="pattern"!==t&&r()?"activate":"deactivate"](o),i[a=e.setting()&&e.active()?"activate":"deactivate"](o),n[a](o),d[a](o)},l=function(){let t="background_attachment";return t=api.control(t)?t:`boldgrid_${t}`,api.control(t)},b=function(){api(...["background_image","background_attachment","background_repeat","bgtfw_background_overlay","boldgrid_background_image_size","boldgrid_background_type"],(...t)=>t.map(t=>t.bind(c)))};$(function(){$(window).on("boldgrid_customizer_refresh",t),function(){let t=!1;api.section("background_image").expanded.bind(d=>{d&&!t?(t=!0,b(),c(),o(),a(api("boldgrid_background_type")()),api("boldgrid_background_type",t=>t.bind(t=>a(t))),e().then(()=>r()),i()):d&&(a(api("boldgrid_background_type")()),c())})}()})}