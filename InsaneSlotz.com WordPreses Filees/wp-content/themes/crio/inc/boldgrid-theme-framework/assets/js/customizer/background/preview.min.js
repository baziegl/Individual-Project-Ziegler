import PaletteSelector from"../color/palette-selector";import ColorPreview from"../color/preview";import{Preview as PreviewUtility}from"../preview";const api=wp.customize;export class Preview{constructor(){this.selector=new PaletteSelector,this.colorPreview=(new ColorPreview).init()}init(){return $(()=>this._onLoad()),this}setImage(){if("image"===api("boldgrid_background_type")()){const o=api("background_image")();if(o){"parallax"===api("background_attachment")()&&(document.querySelector('body > [id^="jarallax-container"]')||(BoldGrid.hooks.didAction("bgtfwParallaxReady")?BoldGrid.hooks.removeAction("bgtfwParallaxReady","bgtfwBackgroundPreview"):_.isUndefined(BoldGrid.hooks.actions.bgtfwParallaxReady)||BoldGrid.hooks.actions.bgtfwParallaxReady.handlers||BoldGrid.hooks.addAction("bgtfwParallaxReady","bgtfwBackgroundPreview",()=>this.setImage()))),document.querySelectorAll('body, body > [id^="jarallax-container"] > div').forEach(a=>{a.style.backgroundImage=`url("${o}")`}),(new PreviewUtility).updateDynamicStyles("bgtfw-background-inline-css",api("bgtfw_background_overlay")()?this._getOverlayCss():"")}}}setBodyClasses(){"image"===api("boldgrid_background_type")()&&api("background_image")()&&api("bgtfw_background_overlay")()&&this.colorPreview.outputColor("bgtfw_background_overlay_color","body",["text-default"])}_onLoad(){this._setupImageChange()}_getOverlayCss(){const o=this.selector.getColor(api("bgtfw_background_overlay_color")(),!0),a=api("bgtfw_background_overlay_alpha")(),e=parent.net.brehaut.Color(o),r=e.setAlpha(a).toString(),t=api("bgtfw_background_overlay_type")(),i='body.custom-background, body.custom-background > [id^="jarallax-container"] > div';return`@supports(background-blend-mode:${t}) { ${i} { background-color: ${r} !important; background-blend-mode: ${t}; } }`+`@supports not (background-blend-mode: ${t}) { ${i} { background-color: ${e.toString()} !important; opacity: ${a}; } }`}_setupImageChange(){api("bgtfw_background_overlay_alpha","bgtfw_background_overlay","bgtfw_background_overlay_color","bgtfw_background_overlay_type","background_image",(...o)=>{o.map(o=>o.bind(()=>{this.setImage(),this.setBodyClasses()}))})}}